---
layout: homework
title: CSCI-UA.0480 - Homework #4
---

<div class="panel panel-default">
	<div class="panel-heading">Homework #4</div>
	<div class="panel-body" markdown="block">

# Express - Static Files, Forms, and Templating __Due  March 2nd__, by 11PM

<h2 style="color:red">DRAFT. Parts 1 and 2 should be usable, but part 3 needs a little more detail</h2>

## Overview

### Description

Create two small sites:

1. a site that simulates generating a passphrase using diceware called __dicey__ 
2. a meal recommendation site called __foodz__ 

You'll explore the following concepts along the way:

* serving static files
* templating
* handling forms

For __dicey__, you'll be creating 3 paths:

* <code>/</code>: the root path, redirects to `dice`
* <code>/dice</code>: a page that simulates rolling dice to generate a pass phrase
    * the number of words and the word separator can be specified in a form
* `/about`: a page about the web application

For __foodz__, you'll be creating 1 page that allows two form submissions:

* <code>/</code>: 
    * has a form that allows the addition of a new meal recommendation
    * has a form that allows filtering of meal recommendations by breakfast, lunch, dinner or anytime
    



### Submission Process

You will be given access to a private repository on GitHub. It will contain: 

1. stub source files in the `src` directory
2. a `.eslintrc`

__Push__ your changes to the homework repository on GitHub.
Commits later than the deadline will not be included in grading

### (4 points) Make at Least 4 Commits

* Commit multiple times throughout your development process.
* Make at least 4 separate commits - (for example, one option may be to make one commit per part in the homework).

## Part 1 - Setup

Because we're creating two express apps in a single repository, the directory layout will be a little different from what we've seen before. Both projects will share the same `package.json`, `node_modules`, `.gitignore` and `.eslintrc`, but they'll each have their own `public` and `views` folders within their own directory in `src`. When you're __done with all of the directions__, you should have a folder structure that looks similar to this:

* `/` (project root)
    * `package.json`
    * `node_modules`
    * `.gitignore`
    * `.eslintrc`
    * `/src`
        * `/dicey`
            * `app.js`
            * `public`
                * `img`
                * `css`
            * `views`
                * `layout.hbs`
        * `/foodz`
            * `app.js`
            * `public`
                * `img`
                * `css`
            * `views`
                * `layout.hbs`

### (2 points) Installing Dependencies

* create a <code>package.json</code> (you can use `npm init` to do this) in the root directory of your project:
* __install__ the following __dependencies__ (make sure you use the <code>--save</code> option):
	* <code>express</code>
	* <code>hbs</code>
	* <code>body-parser</code> (this is used for foodz only)

### (2 points) .gitignore

* create a <code>.gitignore</code> file in the root directory of your project
* ignore the following files:
	* <code>node_modules</code>
	* any other files that are not part of your project... for example:
        * <code>.DS_Store</code> (if you're on OSX)
	    * <code>*.swp</code> (if you're using vim)

### (1 point) Configure .eslintrc

Create a `.eslintrc` file based on the previous project's `.eslintrc` in the root directory of your project


## Part 2 - dicey

In `/src/dicey/app.js`, create an Express application that generates a passphrase by randomly choosing words from a word list. However, instead of simply choosing a random index to pick a word, use the Diceware methodology described here:

http://world.std.com/~reinhold/diceware.html

See the sections

* "What Is Diceware"
* "Using Diceware"

Our application will simulate the generation of a passphrase by:

1. rolling the appropriate number of dice
2. looking up words in the Diceware word list 
3. displaying the dice rolls and associated words
4. displaying the _actual_ resulting passphrase


### Static Files, Basic Routes, Templating

Start off by creating a basic express application runnable through <code>src/dicey/dicey.js</code>. See the [slides on Express](../slides/08/express.html) for a refresher on how to do this. Then:

* use handlebars for templating 
    * see [the slides on templating](../slides/09/templating.html#/)
	* use hbs as the default engine
	* create the appropriate directory structure and templates:  
		* `src/dicey/views` to hold templates
		* `src/dicey/views/layout.hbs` for "common" markup
		* two other `hbs` files (use any name) for the makrup in `/` and `about`
* create the following directory structure in `src/dicey` 
	* <code>public</code>
	* <code>public/css</code>
	* <code>public/img</code>
* add a css file in <code>public/css/base.css</code>
* add the appropriate requires and middleware to enable static file serving; see the [slides on serving static files with Express](../slides/08/express.html#/29)
* test that the css file works
	* for example, try to curl <code>http://localhost:3000/css/base.css</code>
	* or go that url in your browser
* pull in your <code>base.css</code> stylesheet in your `layout.hbs` with a `link` tag
* in <code>views/layout.hbs</code>, drop in the surrounding html that will go on every page
    * add an `h1` element with the title of the site
    * add a navigation links to `/dice` and `/about`
	* don't forget <code>body</code>, surrounded by triple curly braces!
* modify `dicey.js` to accept the following routes:
    * `/` - redirects to `dice` 
    * `/about` - a page describing the site (any content can be placed here)
    * `/dice` - a page that displays a generated passphrase and a form to generate the passphrase
* create `hbs` files in `views` for `about` and `dice` (__name these templates yourself__) 
* `/` - redirect to `/dice` 
* `/about` - should contain text describing the site (__can be any text you want__)
* `/dice` - should contain a form that `GET`s itself (`method` is `GET`, `action` can be left blank to specify that submitting the form will `GET` the current url, `/dicey`)...  that allows the following input:
    * ([skim through the slides on forms](../slides/10/forms.html) or [or read the form element documentation on mdn](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Forms/How_to_structure_an_HTML_form#The_<form>_element) along with this [lengthy article on using forms](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Forms/My_first_HTML_form))
    * a number - to specify how many words the passphrase should consist of 
        * the `name` attribute must be `numWords` (
    * a drop down - to specify what character goes between each generated word; include the following characters: space, dash, comma, star and none
        * the `select` element's `name` attribute must be `glue`
        * each option's value should be the name of the potential separtor/glue character...
        * for example: `<option value="space">space " "</option>` 
        * the possible values are: `space`, `dash`, `comma`, `star` and `none`
    * a submit button
* modify your `base.css` file to style the above pages - __style at your discretion, as long as _some_ styling is present__
* see the image below to see what this may look like

![paths](../resources/img/hw04-dicey-01-paths.gif)

### Handling GET Query String Data

* read in [the diceware file](04/diceware.wordlist.txt) __before your express application serves it routes__
    * this can be done by making sure that `app.listen(8080)` is the last thing that is executed
    * use any method can be used for reading in the file - the synchronous versions of readfile is allowed
    * each line in the file contains a number with 5 digits (each digit is limited to the number of faces on a die, 1 - 6) and an associated word... 
    * store the number / word combinations so that a word can be easily looked up by the number
* in the your route handler for `/dice`, accept __query string data__
* check out the [slides on GET](../slides/10/review-get.html) before proceeding
* modify your route for `/dicey` so that you can append the following query string variables to it:
    * `numWords`
    * `glue`
* access these variables from `req.query` 
* use these variables to generate a passphrase:
    * for every word (`numWords`) specified by the user...
    * roll 5 dice (generate a random number between 1 and 6 inclusive)
    * look up the word in the diceware word list
    * join all of the generated words by the `glue` character
    * __if the submitted `glue` character is not a space, dash, star, comma or none, or if it's not present, default to space__
    * __"save" all of the numbers generated and their associated words__ in a variable as _meta_ data for you passphrase generation
* if `numWords` and `glue` are present and a passphrase was generated...
    * display the resulting passphrase on the page
    * for every word, display the numbers rolled and the word associated with it
    * check out the [slides on templating](../slides/09/templating.html) for help on variables, looping and conditionals in templates
* the finished feature should look something like this

![paths](../resources/img/hw04-dicey-02-url.gif)

	
### Submitting the Form

Now... for the moment of truth!

Instead of using the url string to pass in parameters, you can try using the form that you created to submit parameters instead!

1. test the form by entering a number and a "glue"
2. submit the form and see that a passphrase is generated
3. __and__ that query string values are appended to the url

Troubleshooting

1. check that the `name` attributes of your form elements are the same as the properties that you access on `req.query`; they should be:
    * `numWords`
    * `glue`
2. check that your form's method is `GET` 
3. try logging out the variables that you pass to your template; if your template is receiving variables, but no data is being displayed, then there is an issue in how those variables are accessed in the form

The resulting interaction should look like:


![paths](../resources/img/hw04-dicey-03-form.gif)


## Part 3 - Foodz

Foodz is a meal recommendation site where users can post the name, description and category (breakfast, lunch, dinner or anytime) of a meal as well as view and filter (by category) recommendations. It will use a simple memory-based store (that is, a global `Array` or `Object`) to persist data.

This will be similar to the previous parts, but there will be two forms on a single page, one `GET` and one `POST`. Consequently, there's only one path served for the app: `/`. However, because there are multiple forms, there will be more than one route handler.

### Static Files and Templating Again 

First, lets make sure we can serve up static content, like css and images.

* create the following directory structure in your `src/foodz` directory
	* <code>public</code>
	* <code>public/css</code>
	* <code>public/img</code>
* add a blank css file in <code>public/css/base.css</code>
* create a basic express application called <code>app.js</code>; you don't have to define any routes yet...
* just add the appropriate requires and middleware to enable static file serving:
	* check out the [slides on serving static files with Express](../slides/08/express.html#/29)
* test that both the css files and image work
	* for example, try to curl <code>http://localhost:3000/css/base.css</code>
	* or go that url in your browser
* set up handlebars - [these slides](../slides/09/templating.html#/) may help
	* create the appropriate views/templates and layout 
		* <code>views</code>
		* <code>views/layout.hbs</code>
* in your <code>views/layout.hbs</code>, drop in the surrounding html that will go on every page
	* pull in your <code>base.css</code> stylesheet
	* include an <code>h1</code> on every page... the header on every page should say __The Busy Birder__
	* don't forget <code>body</code>, surrounded by triple curly braces!
* create a template for the single homepage (call this whatever you want... just make sure you can pull it up later), add an <code>h1</code> header with the title of the site
* create the appropriate route so that a <code>GET</code> request pulls up the page
* add some css to change the font family, margins, etc. (__style at yoru discretion__)
* test your page


### Creating Forms

You'll need to forms for this site: one to filter the meal recommendations, the other to add a meal recommendation

1. create a `GET` form that has a blank `action` (so that submissions request the same path); this is the __filter form__:
    * use radio buttons to allow the user to choose which category to filter by
    * __name the radio buttons `filterCategory`__
    * the values of the radio buttons should be `breakfast`, `lunch`, `dinner`, and `anytime`
    * create a submit button
2. create a `POST` form that has a blank `action` (so that submissions request the same path); this is the __add form__:
    * __create 2 text input fields with `name` attributes, `name` and `description`, respectively__
    * __a set of radio buttons, each with `name`ed `category`__ ... 
    * the values of the radio buttons should be `breakfast`, `lunch`, `dinner`, and `anytime`
3. test that you can see the forms


### Seeding Some Content

Now for some actual content. Our site wi

__Bootstrap the list with some data.__

* store all of the birdwatching data in a global variable
* (This isn't really good practice, but we'll have to store the data _somewhere_ for now!)
* you can choose whatever data structure that you want to store a collection of recommended meals (for example, an `Array` of objects) 
* remember that every meal has a `name`, `description`, and `category`
* your application should start off with:
    * name: "chocoramen", 
        * description: "ramen noodles in a chocolate almond milk broth"
        * category: "breakfast"
    * name: "lycheezy"
        * description: "cheese pizza with lychee on top"
        * category: "anytime"
    * name: "crazy cookie"
        * description: "a 1 foot diameter cookie"
        * category: "dinner"


__Add data to your template__

* send your list of recommended meals to your template's context in the call to `render`
* display each meal between the filter and add forms

__Test your page.__

Here's what the page should look like after going to `/`:

![paths](../resources/img/hw04-foodz-01-paths.gif)


### Filter Form

In your `get` route, filter the bojects passed to render by using the values passed through the filter form (these will be in `req.query`). The interaction should look like this:

![filter](../resources/img/hw04-foodz-02-filter.gif)

### Add Form

Create a new `route` that accepts posts.

![add](../resources/img/hw04-foodz-03-add.gif)



{% comment %}

### (6 points) Middleware and Logging

First, get some logging together so that you can troubleshoot. Log out the request that you receive, including the request's body.

* require the <code>body-parser</code> middleware and use it; this will allow you to access the content of the request's body
* set up some logging using your own middleware function; it should include
	* the request method and path
	* followed by the contents of the request body
* maintain a list of birds (can be a global variable, you can use whatever data structure you want)


### (12 points) Bird Form

__Once it's working, create a form...__

* for a quick refresher on forms, check out:
    * [these slide](../slides/10/forms.html)
    * [the form element documentation on mdn](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Forms/How_to_structure_an_HTML_form#The_<form>_element), and a [lengthy article on using forms](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/Forms/My_first_HTML_form)
* add a form beneath the list of birds
	* it should have a text <code>input</code>(name it appropriately... you'll see that name in the request body!)
	* ...as well as a submit <code>input</code>
* the form's method should be <code>POST</code>
* the action should be empty string <code>""</code> or <code>birds</code> (it's <code>POST</code>ing to itself)
* modify __app.js__... add a route so that it accepts <code>POST</code> requests on <code>/birds</code> 
	* in your callback function for this route...
	* use the bird name that was passed in from the form (it should be in the request's body)...
	* to search the current list of birds for an entry with the same name as what is the request's body
	* if it exists, add one to it
	* if it doesn't, create an object for it, with quantity one, and add it to the list
	* ...after that, redirect back to <code>/birds</code> with a <code>GET</code> request
* the log should look something like this:

<code>GET</code> the list page.

<pre><code data-trim contenteditable>GET /birds
=====
req.body: {}
</code></pre>

<code>POST</code> the form (notice the body).

<pre><code data-trim contenteditable>POST /birds
=====
req.body: { name: 'Ostrich', add: 'Add Another Bird' }
</code></pre>

<code>GET</code> the list page again.

<pre><code data-trim contenteditable>GET /birds
=====
req.body: {}
</code></pre>


## Part 5 - Settings Page, Filtering With GET


This feature will allow users to filter the birds on the homepage based on number of sightings. For example, if the threshold is set to 4, only birds that have been sighted 4 times or more will show up on the list. 

1. Modify your list (`/birds`) route so that it only displays birds that have been sighted for a minimum number of times __if it receives the value, `minBirds` in the query string__. 
    * create a new list based off of the query string parameter as the threshold (you can just loop or use a higher order function if your birds are in a list)
    * pass this to your list template for <code>/birds</code> rather than the unfiltered version
2. Add logging so that the query string object is shown in the console


### (12 points) The Settings Page

__Create a form to set the minumum value.__

* the settings page should field <code>GET</code> requests on the path, <code>/settings</code>
* add a link to a _list_ page (birds)
* add an <code>h3</code> header with text indicating that this is the _settings_ page
* add a form to your settings page
	* it should have a text <code>input</code>(name it appropriately... you'll see that name in the request body!)
	* ...as well as a submit <code>input</code>
* the form's method should be <code>GET</code>
* the action should be empty string <code>"/birds"</code> (it's sending you back to the list of birds)
* the page should look like:

<div markdown="block" class="img">
![settings](../resources/img/hw4-settings.png)
</div>

__The log should look something like this:__

<code>GET</code> the settings page.
<pre><code data-trim contenteditable>
GET /settings
=====
req.body: {}
req.query.minVal: undefined
</code></pre>

<code>GET</code> the list page to show the filtered results
<pre><code data-trim contenteditable>
GET /birds
=====
req.body: {}
req.query.minVal: 2
</code></pre>

Everything together may look like this:

<div markdown="block" class="img">
![the busy foodz](../resources/img/hw4-the-busy-foodz.gif)
</div>
{% endcomment %}

</div>

</div>
